<!-- Demo version: 2017.08.10 -->

<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <style>
        #makePeopList li {
            width: 100% !important
        }
    </style>
</head>

<body>
    <div style="width: 20%;height: auto;overflow: hidden; float: left;background: red">
        <ul id="makePeopList">

        </ul>
    </div>
    <section class="make-center" style="width: 80%;float: left;">

        <input type="text" id="room-id" placeholder="name" autocorrect=off autocapitalize=off size=20>
        <input type="text" id="lng" placeholder="lng" autocorrect=off autocapitalize=off size=20>
        <input type="text" id="lat" placeholder="lat" autocorrect=off autocapitalize=off size=20>
        <input type="text" id="Type" placeholder="Type" autocorrect=off autocapitalize=off size=20>
        <input type="text" id="isTeamMember" placeholder="isTeamMember" autocorrect=off autocapitalize=off size=20>
        <input type="text" id="remote-id" placeholder="Type" autocorrect=off autocapitalize=off size=20>
        <button id="open-room">Login</button>
        <button id="join-room">Join Room</button>
        <button id="open-or-join-room">set lng lat</button>

        <br>
        <br>
        <button id="disconnect-user">disconnect</button>
        <button id="btn-leave-room">断开所有连接</button>
        <br>
        <input type="text" id="input-text-chat" placeholder="Enter Text Chat">
        <button id="send-message">send Message</button>
        <button id="share-file">Share File</button>
        <br>
        <div id="room-urls" style="text-align: center;display: none;background: #F1EDED;margin: 15px -10px;border: 1px solid rgb(189, 189, 189);border-left: 0;border-right: 0;"></div>

        <div id="chat-container">
            <div id="file-container"></div>
            <div class="chat-output"></div>
        </div>
        <div id="videos-container"></div>
    </section>

    <script src="/dist/RTCMultiConnection.js"></script>
    <script src="/dev/adapter.js"></script>
    <script src="/dev/myTool.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <!-- custom layout for HTML5 audio/video elements -->
    <link rel="stylesheet" href="/dev/getHTMLMediaElement.css">
    <script src="/dev/getHTMLMediaElement.js"></script>

    <script src="/dev/FileBufferReader.js"></script>


    <script>
       


        window.enableAdapter = true;
        var CC = true;
        var mytool = new myTool();
        mytool.toolInit();
        

        //aa 中包含"userId": , "roomId" 
        setTimeout(() => {
            if(window.chat) {
                var aa = data=JSON.parse(window.chat.getCurrentUser());
                console.log("aa==============="+JSON.stringify(aa));     
                 mytool.CLogin(aa.userId);
           
                 setTimeout(() => {
                 mytool.connection.join(aa.roomId);       
        }, 1000);
        
            }
        }, 100);
        
            
        document.getElementById('open-room').onclick = function () {
            mytool.localUserid = document.getElementById('room-id').value;
            locallng = document.getElementById('lng').value;
            locallat = document.getElementById('lat').value;
            localtype = document.getElementById('Type').value;
            localTM = document.getElementById('isTeamMember').value;
            mytool.CLogin(document.getElementById('room-id').value, locallng, locallat, localtype, localTM);
        };

        //邀请选择用户名加入视频聊天
        document.getElementById('join-room').onclick = function () {

            var remoteName = document.getElementById('remote-id').value;
            mytool.openRoom(remoteName);
        };
        document.getElementById('btn-leave-room').onclick = function () {


            if (mytool.connection.isInitiator) {
              
                mytool.connection.closeEntireSession(function () {

                });
            } else {
                mytool.connection.leave();
            }
            mytool.connection.attachStreams.forEach(function (localStream) {
                localStream.stop();
            });
            // function (stream) {
            //     console.log(stream.getTracks()[1])
            //     try {
            //         stream.getTracks()[1].stop();
            //     } catch (e) {
            //         console.error(e)
            //     }
            // });
        };
        document.getElementById('open-or-join-room').onclick = function () {
            locallng = parseFloat(document.getElementById('lng').value);
            locallat = parseFloat(document.getElementById('lat').value);
            localtype = document.getElementById('Type').value;
            mytool.connection.setLngLat(mytool.localUserid, locallng, locallat, localtype);
            // mytool.connection.disconnectWith(document.getElementById('room-id').value);

        };

        document.getElementById('disconnect-user').onclick = function () {
           
            mytool.connection.disconnectWith(document.getElementById('remote-id').value);

        };



        document.getElementById('share-file').onclick = function () {
            var fileSelector = new FileSelector();
            fileSelector.selectSingleFile(function (file) {
                mytool.sendFile(file);
            });
        };

        document.getElementById('send-message').onclick = function (e) {

            var value = document.getElementById('input-text-chat').value;
            mytool.sendMessage(value);

        };
        mytool.connection.filesContainer = document.getElementById('file-container');
  
      


    </script>
</body>

</html>